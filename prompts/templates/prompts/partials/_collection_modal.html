{# Collection Modal - Save prompt to collection(s) #}
{# Included in base.html, shown via JavaScript #}
{% load static %}

<div class="collection-modal-backdrop" id="collectionModalBackdrop">
    <div class="collection-modal" role="dialog" aria-labelledby="collectionModalTitle" aria-modal="true">

        {# Close Button Row - Own row, positioned right #}
        <div class="collection-modal-close-row">
            <button type="button" class="collection-modal-close" aria-label="Close modal" data-action="close-modal">
                <svg class="icon collection-modal-close-icon" aria-hidden="true">
                    <use href="{% static 'icons/sprite.svg' %}#icon-x"></use>
                </svg>
            </button>
        </div>

        {# Modal Header - Title only #}
        <div class="collection-modal-header">
            <h2 class="collection-modal-title" id="collectionModalTitle">Add to collection(s)</h2>
        </div>

        {# Modal Body - Collection Grid #}
        <div class="collection-modal-body">
            <div class="collection-grid" id="collectionGrid">

                {# Create New Collection Card - Always First #}
                {# Icon sizing controlled by CSS variables, no hardcoded width/height #}
                <button type="button" class="collection-card collection-card-create" data-action="show-create-form">
                    <div class="collection-card-thumbnail collection-card-thumbnail-create">
                        <svg class="icon" aria-hidden="true">
                            <use href="{% static 'icons/sprite.svg' %}#icon-circle-plus"></use>
                        </svg>
                    </div>
                    <span class="collection-card-title">Create new collection</span>
                </button>

                {# Collection Cards Container - Populated by JavaScript #}
                {# Example static card for template reference (icon sizes via CSS variables): #}
                <!--
                <button type="button" class="collection-card" data-collection-id="1" data-action="toggle-collection">
                    <div class="collection-card-thumbnail">
                        <svg class="icon" aria-hidden="true">
                            <use href="{% static 'icons/sprite.svg' %}#icon-image"></use>
                        </svg>

                        {# Overlay contains ALL THREE icons - CSS controls visibility #}
                        {# plus = hover to add, check = saved, minus = hover to remove #}
                        <div class="collection-card-overlay">
                            <svg class="icon icon-plus" aria-hidden="true">
                                <use href="{% static 'icons/sprite.svg' %}#icon-circle-plus"></use>
                            </svg>
                            <svg class="icon icon-check" aria-hidden="true">
                                <use href="{% static 'icons/sprite.svg' %}#icon-circle-check"></use>
                            </svg>
                            <svg class="icon icon-minus" aria-hidden="true">
                                <use href="{% static 'icons/sprite.svg' %}#icon-circle-minus"></use>
                            </svg>
                        </div>
                    </div>
                    <span class="collection-card-title">My collection</span>
                    <span class="collection-card-count">0 items</span>
                </button>
                -->

            </div>

            {# Loading State #}
            <div class="collection-modal-loading" id="collectionModalLoading" style="display: none;">
                <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading collections...</span>
                </div>
            </div>

            {# Empty State - No collections yet #}
            <div class="collection-modal-empty" id="collectionModalEmpty" style="display: none;">
                <p>You haven't created any collections yet.</p>
            </div>

            {# Error State #}
            <div class="collection-modal-error" id="collectionModalError" style="display: none;">
                <div class="alert alert-danger" role="alert">
                    <span id="collectionModalErrorText">Something went wrong. Please try again.</span>
                </div>
            </div>
        </div>

        {# Modal Footer #}
        <div class="collection-modal-footer">
            <a href="#" class="btn-dark-pill" id="collectionsLink">
                Your collections
                <svg class="icon" width="16" height="16" aria-hidden="true">
                    <use href="{% static 'icons/sprite.svg' %}#icon-arrow-right"></use>
                </svg>
            </a>
        </div>

        {# Create Collection Sub-Panel (Hidden by default) #}
        <div class="collection-create-panel" id="collectionCreatePanel" style="display: none;">
            <div class="collection-create-header">
                <button type="button" class="collection-create-back" data-action="hide-create-form" aria-label="Back to collections">
                    <svg class="icon" width="20" height="20" aria-hidden="true">
                        <use href="{% static 'icons/sprite.svg' %}#icon-arrow-left"></use>
                    </svg>
                </button>
                <h3 class="collection-create-title">New collection</h3>
            </div>

            {# Enhanced Form - Micro-Spec #8.5 #}
            <form class="collection-create-form" id="collectionCreateForm">
                {% csrf_token %}

                {# Collection Name #}
                <div class="collection-form-group">
                    <label for="collectionName" class="collection-form-label">Collection name</label>
                    <input type="text"
                           class="collection-form-input"
                           id="collectionName"
                           name="title"
                           maxlength="50"
                           placeholder="My Favorite Prompts..."
                           autocomplete="off"
                           required>
                    <span class="collection-form-hint">Maximum 50 characters</span>
                </div>

                {# Visibility - Private is DEFAULT #}
                <div class="collection-visibility-group">
                    <span class="collection-form-label">Visibility</span>
                    <div class="collection-visibility-options">
                        <label class="collection-radio-label">
                            <input type="radio"
                                   class="collection-radio-input"
                                   name="is_private"
                                   value="true"
                                   id="visibilityPrivate"
                                   checked>
                            Private
                        </label>
                        <label class="collection-radio-label">
                            <input type="radio"
                                   class="collection-radio-input"
                                   name="is_private"
                                   value="false"
                                   id="visibilityPublic">
                            Public
                        </label>
                    </div>
                    {# Helper text that updates based on selection #}
                    <div class="collection-visibility-hint" id="visibilityHint">
                        <svg class="icon" width="16" height="16" aria-hidden="true">
                            <use href="{% static 'icons/sprite.svg' %}#icon-eye-off"></use>
                        </svg>
                        <span>This collection will only be visible to you</span>
                    </div>
                </div>

                {# Two-button layout: Back + Create #}
                <div class="collection-create-actions">
                    <button type="button" class="btn-collection-back" id="collectionBackBtn">
                        Back
                    </button>
                    <button type="submit" class="btn-collection-create" id="createCollectionBtn" disabled>
                        Create new collection
                    </button>
                </div>
            </form>
        </div>

    </div>
</div>

{# Hidden input to store current prompt ID when modal opens #}
<input type="hidden" id="collectionModalPromptId" value="">
