{% extends "base.html" %}
{% load static %}

{% block title %}{{ profile_user.username }}'s Profile - PromptFlow{% endblock %}

{% block content %}
<style>
/* ============================================
   PROFILE HEADER - COMPLETE STYLING
   ============================================ */

/* Overall wrapper */
.profile-header-wrapper {
    background: #ffffff;
    width: 100%;
}

/* ============================================
   SECTION 1: AVATAR & IDENTITY
   ============================================ */

.profile-identity {
    text-align: center;
    padding: 48px 40px 0;
    background: #ffffff;
}

/* Avatar container */
.profile-avatar-container {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

/* Avatar (both image and placeholder) */
.profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    /* REFINEMENT 10: Removed border and box-shadow for clean appearance */
}

/* Avatar placeholder (when no image) */
.profile-avatar-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    font-weight: 700;
    color: #ffffff;
}

/* Avatar color classes (8-color gradient system) */
.avatar-color-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.avatar-color-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.avatar-color-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
.avatar-color-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
.avatar-color-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
.avatar-color-6 { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
.avatar-color-7 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
.avatar-color-8 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #333; }

/* Username */
.profile-username {
    font-size: 32px;
    font-weight: 700;
    color: #1f2937;
    margin: 16px 0 12px;
    line-height: 1.2;
}

/* Bio */
.profile-bio {
    font-size: 16px;
    color: #6b7280;
    margin: 0 auto 16px;
    max-width: 600px;
    line-height: 1.6;
}

/* Edit Profile Button */
.btn-edit-profile {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: #05a081;
    color: #ffffff;
    padding: 10px 24px;
    border-radius: 40px;  /* REFINEMENT 11: Pill shape (was 8px) */
    font-size: 15px;  /* REFINEMENT 11: Increased from 14px to 15px */
    font-weight: 600;
    text-decoration: none;
    margin: 16px auto 24px;
    border: none;
    cursor: pointer;
    transition: background 0.2s ease;
}

.btn-edit-profile:hover {
    background: #048c73;
    color: #ffffff;
    text-decoration: none;
}

/* ============================================
   SECTION 2: STATS ROW
   ============================================ */

.profile-stats-section {
    background: #ffffff;
    padding: 24px 40px;
    margin-bottom: 60px;  /* REFINEMENT 3: Add breathing room below stats */
    /* REFINEMENT 2: Removed border-bottom */
}

.profile-stats-row {
    display: flex;
    justify-content: center;
    gap: 0;  /* REFINEMENT 12: Changed from 48px to 0 for divider approach */
    align-items: flex-start;
}

.profile-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

/* REFINEMENT 12: Add vertical dividers between stats */
.profile-stat:not(:last-child) {
    border-right: 1px solid #e5e7eb;
    padding-right: 24px;
    margin-right: 24px;
}

.profile-stat-value {
    font-size: 24px;
    font-weight: 700;
    color: #1f2937;
    line-height: 1;
}

.profile-stat-label {
    font-size: 14px;
    font-weight: 400;
    color: #6b7280;
    white-space: nowrap;
}

/* ============================================
   SECTIONS 3 & 4: TAB NAVIGATION + FILTERS (Combined)
   ============================================ */

/* REFINEMENT 6: Combined container for tabs and filters on same row */
.profile-navigation-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 40px 24px;
    background: #ffffff;
    /* REFINEMENT 2: Removed border-bottom */
}

.profile-tabs-container {
    display: flex;
    gap: 8px;
    align-items: center;
}

.profile-tab {
    padding: 12px 20px;
    font-size: 17px;  /* REFINEMENT 4: Increased from 15px to 17px */
    font-weight: 500;
    color: #6b7280;
    background: transparent;
    border: none;
    border-radius: 40px;  /* REFINEMENT 1: Pill shape (was 8px 8px 0 0) */
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.profile-tab:hover:not(.profile-tab-active) {
    background: #f3f4f6;
    color: #1f2937;
}

.profile-tab-active {
    background: #000000;
    color: #ffffff;
    font-weight: 600;
}

.profile-tab-count {
    font-size: 17px;  /* REFINEMENT 4: Increased from 13px to 17px - same as tab text */
    opacity: 0.7;
    margin-left: 4px;
}

/* Filter controls (now part of navigation row) */
.profile-filters-container {
    display: flex;
    gap: 12px;
    align-items: center;
}

.profile-filter-dropdown {
    padding: 10px 16px;  /* REFINEMENT 8: Increased from 8px to 10px */
    font-size: 15px;  /* REFINEMENT 8: Increased from 14px to 15px */
    font-weight: 500;
    color: #1f2937;
    background: #f9fafb;  /* REFINEMENT 8: Lighter gray (was #f3f4f6) */
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%231f2937' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 36px;
}

.profile-filter-dropdown:hover {
    background: #f3f4f6;
    border-color: #d1d5db;
}

.profile-filter-dropdown:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
}

/* ============================================
   EMPTY STATE
   ============================================ */

.empty-profile {
    text-align: center;
    padding: 80px 20px;
}

.empty-profile i {
    font-size: 64px;
    color: #d1d5db;
    margin-bottom: 16px;
}

.empty-profile h3 {
    font-size: 24px;
    color: #6b7280;
    margin-bottom: 8px;
}

.empty-profile p {
    font-size: 16px;
    color: #9ca3af;
}

/* ============================================
   RESPONSIVE DESIGN
   ============================================ */

/* REFINEMENT 7: Horizontal scroll for tabs below 990px */
@media (max-width: 990px) {
    .profile-navigation-row {
        flex-direction: column;
        gap: 20px;
        align-items: stretch;
    }

    .profile-tabs-container {
        width: 100%;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .profile-tabs-container::-webkit-scrollbar {
        display: none;
    }

    .profile-tab {
        flex-shrink: 0;
    }

    .profile-filters-container {
        width: 100%;
        justify-content: flex-end;
    }
}

/* Tablet (768px and below) */
@media (max-width: 768px) {
    .profile-identity {
        padding: 32px 20px 0;
    }

    .profile-username {
        font-size: 24px;
    }

    .profile-avatar,
    .profile-avatar-placeholder {
        width: 100px;
        height: 100px;
        font-size: 40px;
    }

    .profile-stats-section {
        padding: 20px;
        margin-bottom: 40px;  /* Adjust spacing on tablet */
    }

    .profile-stat:not(:last-child) {
        padding-right: 16px;
        margin-right: 16px;
    }

    .profile-stat-value {
        font-size: 20px;
    }

    .profile-stat-label {
        font-size: 12px;
    }

    .profile-navigation-row {
        padding: 0 20px 20px;
    }

    .profile-filters-container {
        justify-content: center;
        flex-wrap: wrap;
    }
}

/* Mobile (480px and below) */
@media (max-width: 480px) {
    .profile-identity {
        padding: 24px 16px 0;
    }

    .profile-stats-section {
        margin-bottom: 30px;  /* Adjust spacing on mobile */
    }

    .profile-stat:not(:last-child) {
        padding-right: 12px;
        margin-right: 12px;
    }

    .profile-tab {
        font-size: 15px;
        padding: 10px 16px;
    }

    .profile-filter-dropdown {
        width: 100%;
        max-width: 200px;
    }
}
</style>

<!-- Profile Header - Complete Rebuild -->
<div class="profile-header-wrapper">

    <!-- ============================================
         SECTION 1: AVATAR & IDENTITY (Centered)
         ============================================ -->
    <div class="profile-identity">
        <!-- Avatar Container -->
        <div class="profile-avatar-container">
            {% if profile.avatar %}
                <img src="{{ profile.avatar.url }}" alt="{{ profile_user.username }}'s avatar" class="profile-avatar">
            {% else %}
                <div class="profile-avatar profile-avatar-placeholder avatar-color-{{ profile.get_avatar_color_index }}">
                    {{ profile_user.username|slice:":1"|upper }}
                </div>
            {% endif %}
        </div>

        <!-- Username -->
        <h1 class="profile-username">{{ profile_user.username }}</h1>

        <!-- Bio (if exists) -->
        {% if profile.bio %}
            <p class="profile-bio">{{ profile.bio }}</p>
        {% endif %}

        <!-- Edit Profile Button (Owner Only) -->
        {% if is_owner %}
            <a href="#" class="btn-edit-profile" onclick="alert('Coming soon in Phase F'); return false;">
                <i class="fas fa-pen"></i>
                Edit profile
            </a>
        {% endif %}
    </div>

    <!-- ============================================
         SECTION 2: STATS ROW (Centered Horizontal)
         ============================================ -->
    <div class="profile-stats-section">
        <div class="profile-stats-row">
            <!-- Total Views -->
            <div class="profile-stat">
                <span class="profile-stat-value">0</span>
                <span class="profile-stat-label">Total Views</span>
            </div>

            <!-- All-time rank -->
            <div class="profile-stat">
                <span class="profile-stat-value">0</span>
                <span class="profile-stat-label">All-time rank</span>
            </div>

            <!-- 30-day rank -->
            <div class="profile-stat">
                <span class="profile-stat-value">0</span>
                <span class="profile-stat-label">30-day rank</span>
            </div>
        </div>
    </div>

    <!-- ============================================
         SECTIONS 3 & 4 COMBINED: TABS + FILTERS ON SAME ROW
         ============================================ -->
    <div class="profile-navigation-row">
        <!-- Left side: Tabs -->
        <div class="profile-tabs-container">
            <button class="profile-tab">
                Highlights
                <span class="profile-tab-count">0</span>
            </button>
            <button class="profile-tab profile-tab-active">
                Gallery
                <span class="profile-tab-count">{{ total_prompts|default:0 }}</span>
            </button>
            <button class="profile-tab">Collections</button>
            <button class="profile-tab">Statistics</button>
            <button class="profile-tab">
                Followers
                <span class="profile-tab-count">0</span>
            </button>
            <button class="profile-tab">
                Following
                <span class="profile-tab-count">0</span>
            </button>
        </div>

        <!-- Right side: Filters -->
        <div class="profile-filters-container">
            <!-- Media Type Filter with form submit -->
            <form method="get" id="media-filter-form" style="display: inline;">
                <select name="media" id="media-type-filter" class="profile-filter-dropdown" onchange="this.form.submit()">
                    <option value="all" {% if media_filter == 'all' or not media_filter %}selected{% endif %}>
                        Photos and videos
                    </option>
                    <option value="photos" {% if media_filter == 'photos' %}selected{% endif %}>
                        Photos only
                    </option>
                    <option value="videos" {% if media_filter == 'videos' %}selected{% endif %}>
                        Videos only
                    </option>
                </select>
            </form>

            <!-- Sort Order (placeholder for future functionality) -->
            <select class="profile-filter-dropdown">
                <option value="recency">Recency</option>
                <option value="popular">Popular</option>
                <option value="curated">Curated</option>
            </select>
        </div>
    </div>

</div>

<!-- Masonry Grid (Reusable Partial) - FULL WIDTH -->
{% if prompts %}
    {% include 'prompts/partials/_masonry_grid.html' with items=prompts grid_id='profile-grid' show_load_more=True page_obj=page_obj show_admin_controls=False %}
{% else %}
    <!-- Empty State -->
    <div class="empty-profile">
        <i class="fas fa-image"></i>
        <h3>No {% if media_filter == 'photos' %}photos{% elif media_filter == 'videos' %}videos{% else %}prompts{% endif %} yet</h3>
        <p>
            {% if is_owner %}
                Start sharing your creations!
            {% else %}
                {{ profile_user.username }} hasn't shared any {% if media_filter == 'photos' %}photos{% elif media_filter == 'videos' %}videos{% else %}prompts{% endif %} yet.
            {% endif %}
        </p>
    </div>
{% endif %}

{% endblock %}
